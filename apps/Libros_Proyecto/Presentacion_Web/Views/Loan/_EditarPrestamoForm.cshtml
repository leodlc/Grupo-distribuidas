@model Data.PRESTAMO

@using (Html.BeginForm("Edit", "Loan", FormMethod.Post, new { id = "editarPrestamoForm" }))
{
    @Html.AntiForgeryToken()

    <!-- Mantenemos los campos ocultos para IDCLIENTE e IDLIBRO -->
    <input type="hidden" id="IDCLIENTE" name="IDCLIENTE" value="@Model.IDCLIENTE" />
    <input type="hidden" id="IDLIBRO" name="IDLIBRO" value="@Model.IDLIBRO" />

    <div class="form-horizontal">
        <h4>Editar Préstamo XD</h4>
        <hr />

        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        <div class="form-group">
            <label class="control-label col-md-2" for="FECHAINIPREST">Fecha de inicio del préstamo</label>
            <div class="col-md-10">
                <input type="date" class="form-control" id="FECHAINIPREST" name="FECHAINIPREST" value="@Model.FECHAINIPREST?.ToString(" yyyy-MM-dd")" readonly />
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-md-2" for="FECHAFINPREST">Fecha de finalización de préstamo</label>
            <div class="col-md-10">
                <input type="date" class="form-control" id="FECHAFINPREST" name="FECHAFINPREST" value="@Model.FECHAFINPREST?.ToString(" yyyy-MM-dd")" required />
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-md-2" for="DESCRPREST">Descripción</label>
            <div class="col-md-10">
                <textarea class="form-control" id="DESCRPREST" name="DESCRPREST" rows="3">@Model.DESCRPREST</textarea>
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-md-2" for="ESTADOPREST">Estado</label>
            <div class="col-md-10">
                <select class="form-control" id="ESTADOPREST" name="ESTADOPREST" required>
                    <option value="true" @(Model.ESTADOPREST == true ? "selected" : "")>Activo</option>
                    <option value="false" @(Model.ESTADOPREST == false ? "selected" : "")>Finalizado</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Guardar cambios" class="btn btn-success" />
            </div>
        </div>
    </div>
}

<!-- Agrega jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Agrega los scripts de Bootstrap -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    $(document).ready(function () {
        // Capturar el evento de envío del formulario
        $('#editarPrestamoForm').submit(function (event) {
            event.preventDefault(); // Prevenir el envío por defecto del formulario

            var idCliente = $('#IDCLIENTE').val();
            var idLibro = $('#IDLIBRO').val();
            var formData = {
                IDCLIENTE: idCliente,
                IDLIBRO: idLibro,
                FECHAINIPREST: $('#FECHAINIPREST').val(),
                FECHAFINPREST: $('#FECHAFINPREST').val(),
                DESCRPREST: $('#DESCRPREST').val(),
                ESTADOPREST: $('#ESTADOPREST').val() === 'true' // Convertir a booleano
            };

            $.ajax({
                url: 'http://localhost:54845/api/loan/update/' + idCliente + '/' + idLibro,
                type: 'PUT', // Cambiar a PUT
                contentType: 'application/json',
                data: JSON.stringify(formData), // Enviar los datos como JSON
                success: function (response) {
                    // Manejar la respuesta exitosa si es necesario
                    console.log('Actualización exitosa:', response);
                    // Opcionalmente, cerrar el modal o actualizar la página
                },
                error: function (xhr, status, error) {
                    // Manejar errores si es necesario
                    console.error('Error al actualizar:', error);
                }
            });
        });
    });
</script>